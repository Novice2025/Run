<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Run - Expressions & Exercises</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.hidden {
            opacity: 0;
            visibility: hidden;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-950 text-white font-sans antialiased p-4 sm:p-8">

    <!-- Data for Expressions and Exercises -->
    <script>
        const expressionsData = {
            lower_intermediate: {
                title: 'Lower Intermediate Expressions',
                emoji: 'üü¢',
                color: 'bg-green-600',
                expressions: [
                    { title: 'Run', translation: 'Correr', emoji: 'üèÉ‚Äç‚ôÇÔ∏è', level: 'lower_intermediate', example: 'I run 5 kilometers every day.', fullExplanation: 'Este √© o uso mais comum e literal do verbo, focado no movimento f√≠sico.', shortStory: '**Hist√≥ria:** Para treinar para a pr√≥xima maratona, Jo√£o se levanta cedo. Ele sabe que a disciplina √© crucial, ent√£o ele **corre** dez quil√¥metros no parque todas as manh√£s, n√£o importa o clima.', shortStoryEnglish: '**English Translation:** To train for the upcoming marathon, Jo√£o gets up early. He knows that discipline is crucial, so he **runs** ten kilometers in the park every morning, no matter the weather.' },
                    { title: 'Run up/down', translation: 'Correr para cima/baixo', emoji: '‚¨ÜÔ∏è‚¨áÔ∏è', level: 'lower_intermediate', example: 'The boys just run up the stairs.', fullExplanation: 'Descreve o movimento de correr em uma dire√ß√£o espec√≠fica, seja para cima ou para baixo.', shortStory: '**Hist√≥ria:** O carteiro finalmente chegou com um pacote especial para o anivers√°rio de Lucas. Lucas ficou t√£o animado que **correu escada abaixo** da sua sala de jogos para abrir o presente que ele estava esperando.', shortStoryEnglish: '**English Translation:** The mailman finally arrived with a special birthday package for Lucas. Lucas was so excited that he **ran down the stairs** from his playroom to open the gift he had been waiting for.' },
                    { title: 'Run away/off', translation: 'Fugir', emoji: 'üí®', level: 'lower_intermediate', example: 'Someone runs off to a big city.', fullExplanation: 'Indica o ato de fugir ou ir embora de um lugar.', shortStory: '**Hist√≥ria:** O port√£o da frente da casa ficou aberto por acidente. O cachorro da fam√≠lia, que estava no jardim, viu a oportunidade de sair e **fugiu** para a rua. A fam√≠lia inteira entrou em p√¢nico para encontr√°-lo.', shortStoryEnglish: '**English Translation:** The front gate of the house was left open by accident. The family dog, who was in the yard, saw an opportunity to get out and **ran away** onto the street. The entire family panicked to find him.' },
                    { title: 'Run along', translation: 'Seguir/correr ao longo de', emoji: 'üõ§Ô∏è', level: 'lower_intermediate', example: 'The road runs along the river.', fullExplanation: 'Usado para descrever algo que se estende paralelamente a outra coisa, como uma estrada ou um rio.', shortStory: '**Hist√≥ria:** N√≥s alugamos bicicletas e passamos a tarde na praia. A ciclovia **se estendia ao longo** de toda a orla, oferecendo uma vista espetacular para o oceano enquanto pedal√°vamos.', shortStoryEnglish: '**English Translation:** We rented bicycles and spent the afternoon at the beach. The bike path **ran along** the entire waterfront, offering a spectacular view of the ocean as we rode.' },
                    { title: 'Run at', translation: 'Correr a uma velocidade espec√≠fica', emoji: 'üèéÔ∏è', level: 'lower_intermediate', example: 'You are running at 100km/hr.', fullExplanation: 'Indica a velocidade com que algo ou algu√©m se move.', shortStory: '**Hist√≥ria:** O carro de corrida rugiu enquanto entrava na reta final. O veloc√≠metro estava quase no limite, mostrando que o carro **corria a** 320 km/h, um recorde para a pista.', shortStoryEnglish: '**English Translation:** The race car roared as it entered the final straightaway. The speedometer was almost at its limit, showing that the car was **running at** 320 km/h, a track record.' },
                    { title: 'Running late', translation: 'Estar atrasado', emoji: '‚è∞', level: 'lower_intermediate', example: 'Sorry, I will run late for the meeting.', fullExplanation: 'Uma forma comum de dizer que voc√™ est√° atrasado para um compromisso.', shortStory: '**Hist√≥ria:** O tr√¢nsito da manh√£ estava pior do que o normal por causa de um acidente. O gerente ligou para o escrit√≥rio para avisar: \'Infelizmente, **estarei atrasado** para a nossa reuni√£o das 9h. Pe√ßo desculpas pelo atraso.\'', shortStoryEnglish: '**English Translation:** The morning traffic was worse than usual because of an accident. The manager called the office to let them know: \'Unfortunately, I\'ll be **running late** for our 9 a.m. meeting. My apologies for the delay.\'' },
                    { title: 'Gotta run!', translation: 'Tenho que ir!', emoji: 'üèÉ‚Äç‚ôÄÔ∏è', level: 'lower_intermediate', example: 'Sorry, I can\'t talk now - I\'ve gotta run!', fullExplanation: 'Uma express√£o informal e r√°pida para se despedir.', shortStory: '**Hist√≥ria:** Eles estavam conversando no caf√© quando o telefone de Ana tocou. Era uma chamada importante do trabalho. Ela se despediu rapidamente, dizendo: \'Foi √≥timo te ver, mas **tenho que ir!** Conversamos mais tarde!\'', shortStoryEnglish: '**English Translation:** They were chatting at the coffee shop when Ana\'s phone rang. It was an important call from work. She said goodbye quickly, saying: \'It was great to see you, but **gotta run!** Talk to you later!\'' },
                    { title: 'Run into someone', translation: 'Encontrar por acaso', emoji: 'üëã', level: 'lower_intermediate', example: 'I ran into my ex on the street.', fullExplanation: 'Significa encontrar algu√©m inesperadamente.', shortStory: '**Hist√≥ria:** Carlos estava no supermercado fazendo compras quando, no corredor de frutas, ele **encontrou por acaso** seu antigo professor de ensino m√©dio. Eles pararam para conversar e colocar o papo em dia.', shortStoryEnglish: '**English Translation:** Carlos was at the supermarket doing his shopping when, in the fruit aisle, he **ran into** his old high school teacher. They stopped to chat and catch up.' },
                ],
            },
            advanced: {
                title: 'Advanced Expressions',
                emoji: 'üöÄ',
                color: 'bg-red-600',
                expressions: [
                    { title: 'Run for (election)', translation: 'Candidatar-se', emoji: 'üó≥Ô∏è', level: 'advanced', example: 'Bolsonaro and Haddad both ran for office in 2018.', fullExplanation: 'Usado especificamente para se referir a candidatar-se a um cargo p√∫blico.', shortStory: '**Hist√≥ria:** A jovem advogada, cansada dos problemas de sua comunidade, decidiu tomar uma atitude. Ela fez um an√∫ncio emocionante, informando a todos que iria **se candidatar** a prefeita nas pr√≥ximas elei√ß√µes para fazer a diferen√ßa na cidade.', shortStoryEnglish: '**English Translation:** The young lawyer, tired of the problems in her community, decided to take a stand. She made an emotional announcement, informing everyone that she would **run for** mayor in the upcoming election to make a difference in the city.' },
                    { title: 'Running out of time', translation: 'Estar sem tempo', emoji: '‚è≥', level: 'advanced', example: 'Our time is running out.', fullExplanation: 'Indica que o tempo dispon√≠vel est√° acabando.', shortStory: '**Hist√≥ria:** Os cientistas estavam trabalhando febrilmente para encontrar uma solu√ß√£o para a doen√ßa. Eles sabiam que **estavam ficando sem tempo**, pois a doen√ßa se espalhava rapidamente e as pessoas precisavam de uma cura urgente.', shortStoryEnglish: '**English Translation:** The scientists were working feverishly to find a solution for the disease. They knew they were **running out of time**, as the disease was spreading quickly and people needed an urgent cure.' },
                    { title: 'Run low on (something)', translation: 'Estar com pouco de algo', emoji: '‚õΩ', level: 'advanced', example: 'My cell phone is running low on power.', fullExplanation: 'Usado para dizer que a quantidade de algo (bateria, combust√≠vel, dinheiro) est√° diminuindo.', shortStory: '**Hist√≥ria:** No meio de uma longa viagem de carro, o motorista percebeu que a luz de alerta do combust√≠vel acendeu. Ele sabia que **estava com pouco** de combust√≠vel e come√ßou a procurar um posto de gasolina imediatamente.', shortStoryEnglish: '**English Translation:** In the middle of a long car trip, the driver noticed the fuel warning light come on. He knew he was **running low on** fuel and started looking for a gas station immediately.' },
                    { title: 'Run rampant', translation: 'Sair do controle, se espalhar', emoji: 'üìà', level: 'advanced', example: 'The stock price ran rampant right after the speech.', fullExplanation: 'Descreve algo que est√° se espalhando ou crescendo de forma descontrolada.', shortStory: '**Hist√≥ria:** A fofoca sobre a fus√£o da empresa **se espalhou descontroladamente** pelo escrit√≥rio, criando muita incerteza e ansiedade entre os funcion√°rios. O gerente teve que intervir para acalmar a equipe.', shortStoryEnglish: '**English Translation:** The gossip about the company\'s merger **ran rampant** throughout the office, creating a lot of uncertainty and anxiety among employees. The manager had to intervene to calm the team.' },
                    { title: 'Run through', translation: 'Repassar, revisar', emoji: 'üìù', level: 'advanced', example: 'Would you like me to run through the details with you?', fullExplanation: 'Usado para pedir para revisar ou explicar algo rapidamente.', shortStory: '**Hist√≥ria:** Antes de subir ao palco para sua apresenta√ß√£o, o palestrante olhou para sua equipe e disse: \'Vamos **repassar** os pontos principais uma √∫ltima vez para ter certeza de que n√£o esquecemos nada.\'', shortStoryEnglish: '**English Translation:** Before going on stage for his presentation, the speaker looked at his team and said: \'Let\'s **run through** the main points one last time to make sure we haven\'t forgotten anything.\'' },
                ],
            },
            business: {
                title: 'Business Expressions',
                emoji: 'üíº',
                color: 'bg-blue-600',
                expressions: [
                    { title: 'Run a business', translation: 'Gerenciar/administrar um neg√≥cio', emoji: 'üè¢', level: 'business', example: 'She runs an import/export business.', fullExplanation: 'Descreve o ato de gerir ou ser respons√°vel por um neg√≥cio.', shortStory: '**Hist√≥ria:** Ap√≥s anos como gerente de vendas, Sofia finalmente realizou seu sonho de abrir uma loja de roupas. Ela agora **administra** seu pr√≥prio neg√≥cio, e adora a liberdade e os desafios de ser sua pr√≥pria chefe.', shortStoryEnglish: '**English Translation:** After years as a sales manager, Sofia finally fulfilled her dream of opening a clothing store. She now **runs** her own business, and loves the freedom and challenges of being her own boss.' },
                    { title: 'Run a team', translation: 'Liderar uma equipe', emoji: 'ü§ù', level: 'business', example: 'I\'m running a special project this month.', fullExplanation: 'Significa estar no comando de uma equipe ou projeto.', shortStory: '**Hist√≥ria:** No trabalho, o novo projeto de marketing era ambicioso, mas o gerente estava confiante. Ele disse √† equipe: \'Estou feliz em **liderar** este projeto, e tenho certeza que com o trabalho duro de todos, alcan√ßaremos o sucesso.\'', shortStoryEnglish: '**English Translation:** At work, the new marketing project was ambitious, but the manager was confident. He said to the team, \'I am happy to **run** this project, and I\'m sure that with everyone\'s hard work, we will achieve success.\'' },
                    { title: 'Run the numbers', translation: 'Analisar dados', emoji: 'ÔøΩ', level: 'business', example: 'Can you run the sales figures for me?', fullExplanation: 'Significa processar ou analisar dados, como finan√ßas ou resultados.', shortStory: '**Hist√≥ria:** A equipe de vendas precisava tomar uma decis√£o sobre a nova estrat√©gia. O chefe, antes de qualquer conclus√£o, pediu ao analista: \'Antes de decidir, por favor, **analise os n√∫meros** das vendas do m√™s passado para que possamos tomar uma decis√£o com base em dados concretos.\'', shortStoryEnglish: '**English Translation:** The sales team needed to make a decision about the new strategy. The boss, before any conclusion, asked the analyst: \'Before we decide, please **run the numbers** from last month\'s sales so we can make a data-driven decision.\'' },
                    { title: 'Run a tight ship', translation: 'Ter uma gest√£o rigorosa', emoji: 'üö¢', level: 'business', example: 'The CEO runs a tight ship, so deadlines are always met.', fullExplanation: 'Express√£o idiom√°tica que significa gerenciar uma organiza√ß√£o de forma muito estrita e eficiente.', shortStory: '**Hist√≥ria:** O novo diretor foi contratado para reorganizar a empresa. Desde o primeiro dia, ele mostrou que **tinha uma gest√£o rigorosa**, exigindo pontualidade, disciplina e alta produtividade de todos os funcion√°rios para atingir as metas.', shortStoryEnglish: '**English Translation:** The new director was hired to reorganize the company. From day one, he showed that he **ran a tight ship**, demanding punctuality, discipline, and high productivity from all employees to meet the goals.' },
                ],
            },
            it: {
                title: 'IT Expressions',
                emoji: 'üíª',
                color: 'bg-teal-600',
                expressions: [
                    { title: 'Run a program/scan', translation: 'Executar um programa/scan', emoji: '‚öôÔ∏è', level: 'it', example: 'Run a scan to check for any malware.', fullExplanation: 'Significa iniciar ou executar um software ou processo em um computador.', shortStory: '**Hist√≥ria:** Um dos computadores da empresa come√ßou a funcionar lentamente e a exibir pop-ups suspeitos. O t√©cnico de TI decidiu **executar** um scan completo para verificar a presen√ßa de v√≠rus e malware, a fim de garantir a seguran√ßa dos dados.', shortStoryEnglish: '**English Translation:** One of the company\'s computers started running slowly and displaying suspicious pop-ups. The IT technician decided to **run** a full scan to check for viruses and malware to ensure data security.' },
                    { title: 'Server is running', translation: 'Servidor est√° em funcionamento', emoji: 'üñ•Ô∏è', level: 'it', example: 'The website is down because the server is not running.', fullExplanation: 'Indica que um servidor ou sistema est√° operando e dispon√≠vel.', shortStory: '**Hist√≥ria:** Ap√≥s a manuten√ß√£o programada, a equipe de TI verificou o status dos sistemas. Eles anunciaram: \'Tudo pronto! O servidor principal j√° **est√° em funcionamento** e a conex√£o com a internet est√° de volta ao normal.\'', shortStoryEnglish: '**English Translation:** After the scheduled maintenance, the IT team checked the status of the systems. They announced: \'All set! The main server is **running** again and the internet connection is back to normal.\'' },
                    { title: 'Run a script', translation: 'Executar um script', emoji: 'üìÑ', level: 'it', example: 'The database backup runs automatically every night.', fullExplanation: 'Refere-se √† execu√ß√£o de um script, que √© uma sequ√™ncia de comandos automatizados.', shortStory: '**Hist√≥ria:** O administrador do sistema configurou uma rotina noturna. Agora, o sistema de backup **executa um script** automaticamente √† meia-noite para garantir que todos os dados importantes sejam salvos de forma segura.', shortStoryEnglish: '**English Translation:** The system administrator configured a nightly routine. Now, the backup system **runs a script** automatically at midnight to ensure all important data is saved securely.' },
                ],
            },
        };

        const exerciseData = {
            lower_intermediate: {
                fill_in_the_blanks: [
                    { story: "Yesterday, I went for a morning __ (run). The road __ (runs) along the park, so it was a pleasant experience. On my way, I accidentally __ (ran into) my old friend from school. I told him I had to __ (run) for a meeting, but we promised to catch up later.", answers: ["run", "runs", "ran into", "run"] },
                    { story: "The car engine is not __ (running) properly, so I'm __ (running) low on fuel. I need to find a gas station before I __ (run) out of gas.", answers: ["running", "running", "run"] },
                    { story: "My phone is __ (running) low on battery. I will have to __ (run) home to charge it before I go out. Sorry, I can't stay. I gotta __ (run)!", answers: ["running", "run", "run"] },
                ],
                matching: [
                    { pt: "Estar atrasado", en: "Running late" },
                    { pt: "Encontrar por acaso", en: "Run into someone" },
                    { pt: "Abrir a torneira", en: "Run a tap" },
                    { pt: "Fugir", en: "Run away" },
                    { pt: "Correr a uma velocidade espec√≠fica", en: "Run at a specific speed" },
                ],
                translation: [
                    { pt: "Tenho que ir!", en: "Gotta run!" },
                    { pt: "O motor est√° funcionando.", en: "The engine is running." },
                    { pt: "Corri para dentro da casa.", en: "I ran into the house." },
                    { pt: "Eles est√£o correndo sem tempo.", en: "They are running out of time." },
                    { pt: "A estrada corre ao lado do rio.", en: "The road runs along the river." },
                ]
            },
            advanced: {
                fill_in_the_blanks: [
                    { story: "The new CEO decided to __ (run) a tight ship to improve productivity. We were __ (running) out of time to complete the project, so he asked us to __ (run) the numbers one last time. In the __ (long) run, this will pay off.", answers: ["run", "running", "run", "long"] },
                    { story: "The company's stock price __ (ran) rampant after the news. He is currently __ (running) for a political office, but it seems he is __ (running) into some problems.", answers: ["ran", "running", "running"] },
                    { story: "I asked the new intern to __ (run) a script to automate the process. He is still learning, so he is __ (running) through the manual before he starts.", answers: ["run", "running"] },
                ],
                matching: [
                    { pt: "Gerenciar um neg√≥cio", en: "Run a business" },
                    { pt: "Repassar os detalhes", en: "Run through the details" },
                    { pt: "A longo prazo", en: "In the long run" },
                    { pt: "Ter uma gest√£o rigorosa", en: "Run a tight ship" },
                    { pt: "Sair do controle", en: "Run rampant" },
                ],
                translation: [
                    { pt: "Ela se candidatou para um cargo.", en: "She ran for office." },
                    { pt: "As fofocas se espalharam descontroladamente.", en: "The rumors ran rampant." },
                    { pt: "Voc√™ pode analisar os n√∫meros para mim?", en: "Can you run the numbers for me?" },
                    { pt: "O servidor est√° em funcionamento.", en: "The server is running." },
                    { pt: "Ele lidera uma equipe de marketing.", en: "He runs a marketing team." },
                ]
            }
        };
    </script>

    <!-- Header & Navigation -->
    <header class="flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0 sm:space-x-6 mb-12">
        <h1 class="text-3xl sm:text-5xl font-extrabold text-red-600 tracking-wide text-center sm:text-left">
            <span class="font-light">Run</span> - Expressions by Daby
        </h1>
        <nav class="flex flex-wrap justify-center sm:justify-start gap-2 sm:gap-4 text-gray-300">
            <button id="expressions-btn" class="px-4 py-2 rounded-full font-semibold transition-colors duration-200 bg-red-600 text-white shadow-lg hover:bg-red-500">
                üìö Expressions
            </button>
            <button id="exercises-btn" class="px-4 py-2 rounded-full font-semibold transition-colors duration-200 bg-gray-800 hover:bg-blue-500 text-gray-300">
                üß† Exercises
            </button>
        </nav>
    </header>

    <!-- Main Content Container -->
    <div id="main-content">
        <!-- Expressions Section (Initially visible) -->
        <div id="expressions-section">
            <nav id="expression-categories" class="flex flex-wrap justify-center gap-2 sm:gap-4 text-gray-300 mb-8">
                <!-- Categories will be rendered here by JS -->
            </nav>
            <div id="expressions-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-2">
                <!-- Expression cards will be rendered here by JS -->
            </div>
        </div>

        <!-- Exercises Section (Initially hidden) -->
        <div id="exercises-section" class="hidden">
            <div id="exercise-level-selector" class="flex flex-col items-center justify-center min-h-[50vh]">
                <p class="text-2xl text-gray-500 mb-4">Select an exercise level to begin.</p>
                <div class="flex space-x-4">
                    <button data-level="lower_intermediate" class="exercise-level-btn px-4 py-2 rounded-full font-semibold transition-colors duration-200 bg-gray-800 hover:bg-green-500 text-gray-300">
                        üü¢ Lower Intermediate
                    </button>
                    <button data-level="advanced" class="exercise-level-btn px-4 py-2 rounded-full font-semibold transition-colors duration-200 bg-gray-800 hover:bg-red-500 text-gray-300">
                        üöÄ Advanced
                    </button>
                </div>
            </div>
            <div id="exercise-type-selector" class="hidden flex flex-col items-center justify-center min-h-[50vh]">
                <p id="exercise-type-title" class="text-2xl text-gray-500 mb-4"></p>
                <div class="flex flex-wrap justify-center gap-4">
                    <button data-type="fill_in_the_blanks" class="exercise-type-btn px-6 py-3 bg-blue-600 rounded-full font-semibold hover:bg-blue-700 transition-colors">
                        Completar a Lacuna
                    </button>
                    <button data-type="matching" class="exercise-type-btn px-6 py-3 bg-purple-600 rounded-full font-semibold hover:bg-purple-700 transition-colors">
                        Correspond√™ncia
                    </button>
                    <button data-type="translation" class="exercise-type-btn px-6 py-3 bg-yellow-600 rounded-full font-semibold hover:bg-yellow-700 transition-colors">
                        Tradu√ß√£o
                    </button>
                </div>
            </div>
            <div id="exercise-content" class="hidden">
                <!-- Exercises will be rendered here by JS -->
            </div>
        </div>
    </div>

    <!-- Modal for detailed expression view -->
    <div id="expression-modal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 p-4">
        <div id="modal-content" class="relative w-full max-w-4xl bg-gray-900 rounded-lg shadow-xl p-6 sm:p-8 border-t-4 border-red-600">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <!-- Modal content will be populated by JS -->
        </div>
    </div>

    <!-- JavaScript for all functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const expressionsBtn = document.getElementById('expressions-btn');
            const exercisesBtn = document.getElementById('exercises-btn');
            const expressionsSection = document.getElementById('expressions-section');
            const exercisesSection = document.getElementById('exercises-section');
            const expressionCategories = document.getElementById('expression-categories');
            const expressionsGrid = document.getElementById('expressions-grid');
            const expressionModal = document.getElementById('expression-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const modalContent = document.getElementById('modal-content');
            
            const exerciseLevelSelector = document.getElementById('exercise-level-selector');
            const exerciseTypeSelector = document.getElementById('exercise-type-selector');
            const exerciseContent = document.getElementById('exercise-content');
            const exerciseTypeTitle = document.getElementById('exercise-type-title');

            let currentLevel = null;
            let currentCategory = 'lower_intermediate';

            // --- UI Rendering Functions ---

            // Renders the categories navigation buttons
            function renderCategories() {
                expressionCategories.innerHTML = '';
                Object.keys(expressionsData).forEach(category => {
                    const data = expressionsData[category];
                    const button = document.createElement('button');
                    button.textContent = `${data.emoji} ${getCategoryLabel(category)}`;
                    button.classList.add('px-4', 'py-2', 'rounded-full', 'font-semibold', 'transition-colors', 'duration-200', 'hover:bg-gray-700', 'text-gray-300');
                    button.dataset.category = category;
                    button.onclick = () => {
                        currentCategory = category;
                        renderExpressions();
                        updateCategoryButtons();
                    };
                    expressionCategories.appendChild(button);
                });
                updateCategoryButtons();
            }

            // Updates the active state of category buttons
            function updateCategoryButtons() {
                document.querySelectorAll('#expression-categories button').forEach(btn => {
                    if (btn.dataset.category === currentCategory) {
                        btn.classList.add(expressionsData[currentCategory].color, 'text-white', 'shadow-lg');
                        btn.classList.remove('bg-gray-800', 'hover:bg-gray-700');
                    } else {
                        btn.classList.remove('bg-red-600', 'bg-green-600', 'bg-blue-600', 'bg-teal-600', 'text-white', 'shadow-lg');
                        btn.classList.add('bg-gray-800', 'hover:bg-gray-700');
                    }
                });
            }

            // Renders the expression cards for the selected category
            function renderExpressions() {
                expressionsGrid.innerHTML = '';
                const expressions = expressionsData[currentCategory].expressions;
                expressions.forEach(expression => {
                    const card = document.createElement('div');
                    card.classList.add('relative', 'h-48', 'bg-gray-800', 'rounded-lg', 'shadow-lg', 'overflow-hidden', 'cursor-pointer', 'transform', 'transition-transform', 'duration-300', 'hover:scale-105', 'hover:bg-gray-700');
                    card.innerHTML = `
                        <div class="p-4 h-full flex flex-col justify-end">
                            <span class="absolute top-2 right-2 text-xs font-semibold px-2 py-1 rounded-full ${expressionsData[currentCategory].color}">
                                ${getCategoryLabel(expression.level)}
                            </span>
                            <h3 class="text-lg sm:text-xl font-bold text-red-400">
                                ${expression.emoji} ${expression.title}
                            </h3>
                            <p class="text-sm text-gray-400 mt-1 truncate">${expression.translation}</p>
                            <p class="text-xs text-gray-500 mt-2 italic truncate">Ex: "${expression.example}"</p>
                        </div>
                    `;
                    card.onclick = () => showExpressionModal(expression);
                    expressionsGrid.appendChild(card);
                });
            }

            // Shows the modal with a detailed expression
            function showExpressionModal(expression) {
                const categoryColor = expressionsData[expression.level]?.color || 'bg-gray-500';
                modalContent.innerHTML = `
                    <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <h3 class="text-2xl sm:text-3xl font-bold text-red-500 mb-2">
                        ${expression.emoji} ${expression.title}
                    </h3>
                    <span class="inline-block text-xs font-semibold px-2 py-1 rounded-full ${categoryColor} mb-4">
                        ${getCategoryLabel(expression.level)}
                    </span>
                    <p class="text-lg text-gray-300 mb-4">
                        <span class="font-semibold">Translation:</span> ${expression.translation}
                    </p>
                    <p class="text-md text-gray-200 mb-4">
                        <span class="font-semibold">Explanation:</span> ${expression.fullExplanation}
                    </p>
                    <p class="text-sm text-gray-400 mb-6 italic">
                        <span class="font-semibold not-italic">Example:</span> "${expression.example}"
                    </p>
                    <h4 class="text-xl sm:text-2xl font-bold mb-4 mt-6">Real situation:</h4>
                    <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                        <div class="prose prose-invert max-w-none text-gray-300 leading-relaxed sm:w-1/2">
                            ${expression.shortStory.replace(/\n\n/g, '<p>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
                        </div>
                        <div class="prose prose-invert max-w-none text-gray-400 leading-relaxed sm:w-1/2">
                            ${expression.shortStoryEnglish.replace(/\n\n/g, '<p>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
                        </div>
                    </div>
                `;
                expressionModal.classList.remove('hidden');
                document.getElementById('close-modal-btn').onclick = () => expressionModal.classList.add('hidden');
            }

            // Renders the fill-in-the-blanks exercise
            function renderFillInTheBlanks(level) {
                const questions = exerciseData[level].fill_in_the_blanks;
                exerciseContent.innerHTML = `
                    <div class="space-y-8">
                        <h3 class="text-xl font-bold text-red-400">Fill in the Blanks</h3>
                        ${questions.map((q, qIndex) => `
                            <div class="p-4 bg-gray-800 rounded-lg">
                                <p class="text-lg leading-relaxed story-text" data-index="${qIndex}">${q.story.replace(/\((.*?)\)/g, '')}</p>
                                <div class="correct-answers hidden mt-4 text-sm text-gray-400">
                                    <p>Correct Answers:</p>
                                    <ul class="list-disc list-inside mt-2">
                                        ${q.answers.map(answer => `<li>${answer}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `).join('')}
                        <div class="flex space-x-4">
                            <button id="check-blanks" class="px-6 py-2 bg-blue-600 rounded-full font-semibold hover:bg-blue-700 transition-colors">
                                Check Answers
                            </button>
                            <button id="reset-blanks" class="px-6 py-2 bg-gray-600 rounded-full font-semibold hover:bg-gray-700 transition-colors">
                                Reset
                            </button>
                        </div>
                    </div>
                `;

                // Add input fields to the rendered story texts
                document.querySelectorAll('.story-text').forEach(storyDiv => {
                    const qIndex = storyDiv.dataset.index;
                    let storyHTML = storyDiv.innerHTML;
                    const answers = exerciseData[level].fill_in_the_blanks[qIndex].answers;

                    answers.forEach((answer, aIndex) => {
                        storyHTML = storyHTML.replace('__', `<input type="text" class="fill-in-input inline-block w-24 p-1 mx-2 rounded-md text-gray-900 bg-gray-200 focus:outline-none" data-q-index="${qIndex}" data-a-index="${aIndex}" />`);
                    });
                    storyDiv.innerHTML = storyHTML;
                });
                
                // Add event listeners for buttons
                document.getElementById('check-blanks').onclick = () => checkFillInTheBlanks(level);
                document.getElementById('reset-blanks').onclick = () => renderFillInTheBlanks(level);
            }

            // Checks the fill-in-the-blanks answers and provides feedback
            function checkFillInTheBlanks(level) {
                const questions = exerciseData[level].fill_in_the_blanks;
                document.querySelectorAll('.fill-in-input').forEach(input => {
                    const qIndex = input.dataset.qIndex;
                    const aIndex = input.dataset.aIndex;
                    const correctAnswer = questions[qIndex].answers[aIndex];
                    if (input.value.trim().toLowerCase() === correctAnswer.toLowerCase()) {
                        input.classList.remove('bg-gray-200');
                        input.classList.add('bg-green-300', 'text-black');
                    } else {
                        input.classList.remove('bg-gray-200');
                        input.classList.add('bg-red-300', 'text-black');
                    }
                });
                document.querySelectorAll('.correct-answers').forEach(div => div.classList.remove('hidden'));
            }

            // Renders the matching exercise
            function renderMatching(level) {
                const questions = exerciseData[level].matching;
                const leftItems = questions.map(item => item.pt);
                const rightItems = questions.map(item => item.en).sort(() => Math.random() - 0.5);

                exerciseContent.innerHTML = `
                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-red-400">Matching Exercise</h3>
                        <p class="text-gray-400">Match the Portuguese expression with its English translation.</p>
                        <div class="flex justify-between items-start space-x-4">
                            <div class="w-1/2 space-y-2">
                                ${leftItems.map((item, index) => `<div class="p-4 bg-gray-800 rounded-lg text-lg">${item}</div>`).join('')}
                            </div>
                            <div id="right-items" class="w-1/2 space-y-2">
                                ${rightItems.map((item, index) => `<div data-item="${item}" class="matching-item p-4 rounded-lg cursor-pointer transition-colors duration-200 bg-gray-800 hover:bg-gray-700 text-lg">${item}</div>`).join('')}
                            </div>
                        </div>
                        <div class="flex space-x-4 mt-6">
                            <button id="check-matching" class="px-6 py-2 bg-blue-600 rounded-full font-semibold hover:bg-blue-700 transition-colors">
                                Show Answers
                            </button>
                            <button id="reset-matching" class="px-6 py-2 bg-gray-600 rounded-full font-semibold hover:bg-gray-700 transition-colors">
                                Reset
                            </button>
                        </div>
                    </div>
                `;

                document.getElementById('check-matching').onclick = () => checkMatching(level);
                document.getElementById('reset-matching').onclick = () => renderMatching(level);
            }

            // Checks the matching answers
            function checkMatching(level) {
                const questions = exerciseData[level].matching;
                const rightItemsDivs = document.querySelectorAll('.matching-item');
                rightItemsDivs.forEach(div => {
                    const ptText = questions.find(q => q.en === div.dataset.item).pt;
                    const leftItemDiv = [...document.querySelectorAll('.w-1\/2 > div')].find(d => d.textContent.includes(ptText));
                    if (leftItemDiv) {
                        div.classList.remove('bg-gray-800', 'hover:bg-gray-700');
                        div.classList.add('bg-green-600');
                    } else {
                         div.classList.remove('bg-gray-800', 'hover:bg-gray-700');
                         div.classList.add('bg-red-600');
                    }
                });
            }

            // Renders the translation exercise
            function renderTranslation(level) {
                const questions = exerciseData[level].translation;
                exerciseContent.innerHTML = `
                    <div class="space-y-8">
                        <h3 class="text-xl font-bold text-red-400">Translation (Portuguese to English)</h3>
                        ${questions.map((q, index) => `
                            <div class="p-4 bg-gray-800 rounded-lg">
                                <p class="text-lg font-semibold text-gray-300">Question ${index + 1}:</p>
                                <p class="text-md mt-2 text-gray-100">"${q.pt}"</p>
                                <textarea class="translation-input mt-4 w-full p-2 rounded-md text-gray-900 bg-gray-200 focus:outline-none" placeholder="Your translation here..." rows="3" data-index="${index}"></textarea>
                                <div class="correct-answer hidden mt-2 text-sm text-gray-400">
                                    <p>Correct Answer:</p>
                                    <p class="italic text-green-400">"${q.en}"</p>
                                </div>
                            </div>
                        `).join('')}
                        <div class="flex space-x-4">
                            <button id="check-translation" class="px-6 py-2 bg-blue-600 rounded-full font-semibold hover:bg-blue-700 transition-colors">
                                Check Answers
                            </button>
                            <button id="reset-translation" class="px-6 py-2 bg-gray-600 rounded-full font-semibold hover:bg-gray-700 transition-colors">
                                Reset
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('check-translation').onclick = () => checkTranslation(level);
                document.getElementById('reset-translation').onclick = () => renderTranslation(level);
            }

            // Checks the translation answers
            function checkTranslation(level) {
                const questions = exerciseData[level].translation;
                document.querySelectorAll('.translation-input').forEach(input => {
                    const index = input.dataset.index;
                    const correctAnswer = questions[index].en;
                    if (input.value.trim().toLowerCase() === correctAnswer.toLowerCase()) {
                        input.classList.remove('bg-gray-200');
                        input.classList.add('bg-green-300', 'text-black');
                    } else {
                        input.classList.remove('bg-gray-200');
                        input.classList.add('bg-red-300', 'text-black');
                    }
                });
                document.querySelectorAll('.correct-answer').forEach(div => div.classList.remove('hidden'));
            }

            // Helper function to get category label
            function getCategoryLabel(category) {
                const labels = {
                    'lower_intermediate': 'Lower Intermediate',
                    'advanced': 'Advanced',
                    'business': 'Business',
                    'it': 'IT'
                };
                return labels[category] || category;
            }

            // --- Event Listeners and Initial Load ---
            expressionsBtn.onclick = () => {
                expressionsSection.classList.remove('hidden');
                exercisesSection.classList.add('hidden');
                expressionsBtn.classList.remove('bg-gray-800', 'hover:bg-blue-500');
                expressionsBtn.classList.add('bg-red-600', 'text-white', 'shadow-lg');
                exercisesBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                exercisesBtn.classList.add('bg-gray-800', 'hover:bg-blue-500');
            };

            exercisesBtn.onclick = () => {
                exercisesSection.classList.remove('hidden');
                expressionsSection.classList.add('hidden');
                exercisesBtn.classList.remove('bg-gray-800', 'hover:bg-blue-500');
                exercisesBtn.classList.add('bg-blue-600', 'text-white', 'shadow-lg');
                expressionsBtn.classList.remove('bg-red-600', 'text-white', 'shadow-lg');
                expressionsBtn.classList.add('bg-gray-800', 'hover:bg-red-500');
                
                // Reset exercise view on switch
                exerciseLevelSelector.classList.remove('hidden');
                exerciseTypeSelector.classList.add('hidden');
                exerciseContent.classList.add('hidden');
                currentLevel = null;
            };

            document.querySelectorAll('.exercise-level-btn').forEach(btn => {
                btn.onclick = () => {
                    currentLevel = btn.dataset.level;
                    exerciseLevelSelector.classList.add('hidden');
                    exerciseTypeSelector.classList.remove('hidden');
                    exerciseTypeTitle.textContent = `Select an exercise type for ${getCategoryLabel(currentLevel)}.`;
                };
            });

            document.querySelectorAll('.exercise-type-btn').forEach(btn => {
                btn.onclick = () => {
                    const type = btn.dataset.type;
                    exerciseTypeSelector.classList.add('hidden');
                    exerciseContent.classList.remove('hidden');
                    if (type === 'fill_in_the_blanks') renderFillInTheBlanks(currentLevel);
                    if (type === 'matching') renderMatching(currentLevel);
                    if (type === 'translation') renderTranslation(currentLevel);
                };
            });

            // Initial render
            renderCategories();
            renderExpressions();
        });
    </script>
</body>
</html>
ÔøΩ
