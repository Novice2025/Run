<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Run - Expressions & Exercises</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.hidden {
            opacity: 0;
            visibility: hidden;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-950 text-white font-sans antialiased p-4 sm:p-8">

    <!-- Data for Expressions and Exercises -->
    <script>
        const expressionsData = {
            lower_intermediate: {
                title: 'Lower Intermediate Expressions',
                emoji: 'üü¢',
                color: 'bg-green-600',
                expressions: [
                    { title: 'Run', translation: 'Correr', emoji: 'üèÉ‚Äç‚ôÇÔ∏è', level: 'lower_intermediate', example: 'I run 5 kilometers every day.', fullExplanation: 'Este √© o uso mais comum e literal do verbo, focado no movimento f√≠sico.', shortStory: '**Hist√≥ria:** Para treinar para a pr√≥xima maratona, Jo√£o se levanta cedo. Ele sabe que a disciplina √© crucial, ent√£o ele **corre** dez quil√¥metros no parque todas as manh√£s, no importa o clima.', shortStoryEnglish: '**English Translation:** To train for the upcoming marathon, Jo√£o gets up early. He knows that discipline is crucial, so he **runs** ten kilometers in the park every morning, no matter the weather.' },
                    { title: 'Run to (a place)', translation: 'Ir rapidamente a um lugar', emoji: 'üèÉ‚Äç‚ôÇÔ∏èüí®', level: 'lower_intermediate', example: 'Would you run to the post office and get me some stamps?', fullExplanation: 'Usado para pedir a algu√©m que v√° a um lugar rapidamente para realizar uma tarefa ou resolver um problema, geralmente porque h√° uma certa urg√™ncia.', shortStory: '**Hist√≥ria:** Minha m√£e estava preparando o bolo de anivers√°rio e percebeu que faltava a√ß√∫car. Ela me olhou e disse: "Filho, por favor, **corra at√© o supermercado** para comprar a√ß√∫car, a confeitaria fecha em 10 minutos."', shortStoryEnglish: '**English Translation:** My mom was preparing the birthday cake and realized she was out of sugar. She looked at me and said, "Son, please **run to the supermarket** to buy sugar, the pastry shop closes in 10 minutes."' },
                    { title: 'Run up/down', translation: 'Correr para cima/baixo', emoji: '‚¨ÜÔ∏è‚¨áÔ∏è', level: 'lower_intermediate', example: 'The boys just run up the stairs.', fullExplanation: 'Descreve o movimento de correr em uma dire√ß√£o espec√≠fica, seja para cima ou para baixo.', shortStory: '**Hist√≥ria:** O carteiro finalmente chegou com um pacote especial para o anivers√°rio de Lucas. Lucas ficou t√£o animado que **correu escada abaixo** da sua sala de jogos para abrir o presente que ele estava esperando.', shortStoryEnglish: '**English Translation:** The mailman finally arrived with a special birthday package for Lucas. He was so excited that he **ran down the stairs** from his playroom to open the gift he had been waiting for.' },
                    { title: 'Run away/off', translation: 'Fugir', emoji: 'üí®', level: 'lower_intermediate', example: 'Someone runs off to a big city.', fullExplanation: 'Indica o ato de fugir ou ir embora de um lugar.', shortStory: '**Hist√≥ria:** O port√£o da frente da casa ficou aberto por acidente. O cachorro da fam√≠lia, que estava no jardim, viu a oportunidade de sair e **fugiu** para a rua. A fam√≠lia inteira entrou em p√¢nico para encontr√°-lo.', shortStoryEnglish: '**English Translation:** The front gate of the house was left open by accident. The family dog, who was in the yard, saw an opportunity to get out and **ran away** onto the street. The entire family panicked to find him.' },
                    { title: 'Run along', translation: 'Seguir/correr ao longo de', emoji: 'üõ§Ô∏è', level: 'lower_intermediate', example: 'The road runs along the river.', fullExplanation: 'Usado para descrever algo que se estende paralelamente a outra coisa, como uma estrada ou um rio.', shortStory: '**Hist√≥ria:** N√≥s alugamos bicicletas e passamos a tarde na praia. A ciclovia **se estendia ao longo** de toda a orla, oferecendo uma vista espetacular para o oceano enquanto pedal√°vamos.', shortStoryEnglish: '**English Translation:** We rented bicycles and spent the afternoon at the beach. The bike path **ran along** the entire waterfront, offering a spectacular view of the ocean as we rode.' },
                    { title: 'Run at', translation: 'Correr a uma velocidade espec√≠fica', emoji: 'üèéÔ∏è', level: 'lower_intermediate', example: 'You are running at 100km/hr.', fullExplanation: 'Indica a velocidade com que algo ou algu√©m se move.', shortStory: '**Hist√≥ria:** O carro de corrida rugiu enquanto entrava na reta final. O veloc√≠metro estava quase no limite, mostrando que o carro **corria a** 320 km/h, um recorde para a pista.', shortStoryEnglish: '**English Translation:** The race car roared as it entered the final straightaway. The speedometer was almost at its limit, showing that the car was **running at** 320 km/h, a track record.' },
                    { title: 'Running late', translation: 'Estar atrasado', emoji: '‚è∞', level: 'lower_intermediate', example: 'Sorry, I will run late for the meeting.', fullExplanation: 'Uma forma comum de dizer que voc√™ est√° atrasado para um compromisso.', shortStory: '**Hist√≥ria:** O tr√¢nsito da manh√£ estava pior do que o normal por causa de um acidente. O gerente ligou para o escrit√≥rio para avisar: \'Infelizmente, **estarei atrasado** para a nossa reuni√£o das 9h. Pe√ßo desculpas pelo atraso.\'', shortStoryEnglish: '**English Translation:** The morning traffic was worse than usual because of an accident. The manager called the office to let them know: \'Unfortunately, I\'ll be **running late** for our 9 a.m. meeting. My apologies for the delay.\'' },
                    { title: 'Gotta run!', translation: 'Tenho que ir!', emoji: 'üèÉ‚Äç‚ôÄÔ∏è', level: 'lower_intermediate', example: 'Sorry, I can\'t talk now - I\'ve gotta run!', fullExplanation: 'Uma express√£o informal e r√°pida para se despedir.', shortStory: '**Hist√≥ria:** Eles estavam conversando no caf√© quando o telefone de Ana tocou. Era uma chamada importante do trabalho. Ela se despediu rapidamente, dizendo: \'Foi √≥timo te ver, mas **tenho que ir!** Conversamos mais tarde!\'', shortStoryEnglish: '**English Translation:** They were chatting at the coffee shop when Ana\'s phone rang. It was an important call from work. She said goodbye quickly, saying: \'It was great to see you, but **gotta run!** Talk to you later!\'' },
                    { title: 'Run into someone', translation: 'Encontrar por acaso', emoji: 'üëã', level: 'lower_intermediate', example: 'I ran into my ex on the street.', fullExplanation: 'Significa encontrar algu√©m inesperadamente.', shortStory: '**Hist√≥ria:** Carlos estava no supermercado fazendo compras quando, no corredor de frutas, ele **encontrou por acaso** seu antigo professor de ensino m√©dio. Eles pararam para conversar e colocar o papo em dia.', shortStoryEnglish: '**English Translation:** Carlos was at the supermarket doing his shopping when, in the fruit aisle, he **ran into** his old high school teacher. They stopped to chat and catch up.' },
                    { title: 'Run a red light', translation: 'Avan√ßar o sinal vermelho', emoji: 'üö¶', level: 'lower_intermediate', example: 'You shouldn\'t run a red light.', fullExplanation: 'Significa desrespeitar a sinaliza√ß√£o e passar com o carro em um sinal vermelho.', shortStory: '**Hist√≥ria:** O motorista estava com pressa para chegar ao trabalho, mas n√£o viu que o sem√°foro mudou para vermelho. Ele **avan√ßou o sinal vermelho** sem perceber, e quase causou um acidente. Por sorte, ningu√©m se machucou.', shortStoryEnglish: '**English Translation:** The driver was in a hurry to get to work but didn\'t see that the traffic light had turned red. He **ran a red light** without noticing and almost caused an accident. Luckily, no one was hurt.' },
                    { title: 'Run a risk', translation: 'Correr um risco', emoji: 'üé≤', level: 'lower_intermediate', example: 'We are running a big risk on this business.', fullExplanation: 'Significa colocar-se ou colocar algo em uma situa√ß√£o de perigo ou incerteza.', shortStory: '**Hist√≥ria:** O gerente de vendas tinha que decidir se a empresa deveria investir em um novo produto. Ele sabia que a decis√£o **envolvia um grande risco**, mas acreditava que a recompensa poderia ser enorme. Ele decidiu seguir em frente, confiando em sua intui√ß√£o.', shortStoryEnglish: '**English Translation:** The sales manager had to decide whether the company should invest in a new product. He knew the decision **ran a big risk**, but he believed the reward could be huge. He decided to go ahead, trusting his gut feeling.' }
                ],
            },
            advanced: {
                title: 'Advanced Expressions',
                emoji: 'üöÄ',
                color: 'bg-red-600',
                expressions: [
                    { title: 'Have a good run', translation: 'Ter um per√≠odo de sucesso', emoji: 'ü•á', level: 'advanced', example: 'The band had a good run in the 1990s, with several world tours.', fullExplanation: 'Usado para descrever um per√≠odo de sucesso, especialmente em esportes ou neg√≥cios, que chega ao fim.', shortStory: '**Hist√≥ria:** Ap√≥s vencerem tr√™s campeonatos consecutivos, os jogadores se aposentaram. Eles **tiveram um bom per√≠odo de sucesso** no futebol, e os f√£s se lembravam de cada vit√≥ria com carinho.', shortStoryEnglish: '**English Translation:** After winning three consecutive championships, the players retired. They **had a good run** in football, and the fans fondly remembered every victory.' },
                    { title: 'Running on the limit', translation: 'Trabalhando no limite', emoji: 'ü•µ', level: 'advanced', example: 'He\'s been working 12-hour days, he\'s really running on the limit.', fullExplanation: 'Usado para descrever a situa√ß√£o de algu√©m que est√° for√ßando suas capacidades f√≠sicas ou mentais ao m√°ximo, geralmente por causa de um trabalho intenso ou um prazo apertado.', shortStory: '**Hist√≥ria:** O programador tinha um prazo apertado para entregar o novo software. Ele passava noites trabalhando e quase n√£o dormia. Seu amigo o viu exausto e disse: \'Voc√™ tem que descansar, parece que est√° **trabalhando no limite**.\'', shortStoryEnglish: '**English Translation:** The programmer had a tight deadline to deliver the new software. He spent nights working and barely slept. His friend saw him exhausted and said, \'You have to rest, it looks like you\'re **running on the limit**.\'' },
                    { title: 'Run for (election)', translation: 'Candidatar-se', emoji: 'üó≥Ô∏è', level: 'advanced', example: 'Bolsonaro and Haddad both ran for office in 2018.', fullExplanation: 'Usado especificamente para se referir a candidatar-se a um cargo p√∫blico.', shortStory: '**Hist√≥ria:** A jovem advogada, cansada dos problemas de sua comunidade, decidiu tomar uma atitude. Ela fez um an√∫ncio emocionante, informando a todos que iria **se candidatar** a prefeita nas pr√≥ximas elei√ß√µes para fazer a diferen√ßa na cidade.', shortStoryEnglish: '**English Translation:** The young lawyer, tired of the problems in her community, decided to take a stand. She made an emotional announcement, informing everyone that she would **run for** mayor in the upcoming election to make a difference in the city.' },
                    { title: 'Running out of time', translation: 'Estar sem tempo', emoji: '‚è≥', level: 'advanced', example: 'Our time is running out.', fullExplanation: 'Indica que o tempo dispon√≠vel est√° acabando.', shortStory: '**Hist√≥ria:** Os cientistas estavam trabalhando febrilmente para encontrar uma solu√ß√£o para a doen√ßa. Eles sabiam que **estavam ficando sem tempo**, pois a doen√ßa se espalhava rapidamente e as pessoas precisavam de uma cura urgente.', shortStoryEnglish: '**English Translation:** The scientists were working feverishly to find a solution for the disease. They knew they were **running out of time**, as the disease was spreading quickly and people needed an urgent cure.' },
                    { title: 'Run low on (something)', translation: 'Estar com pouco de algo', emoji: '‚õΩ', level: 'advanced', example: 'My cell phone is running low on power.', fullExplanation: 'Usado para dizer que a quantidade de algo (bateria, combust√≠vel, dinheiro) est√° diminuindo.', shortStory: '**Hist√≥ria:** No meio de uma longa viagem de carro, o motorista percebeu que a luz de alerta do combust√≠vel acendeu. Ele sabia que **estava com pouco** de combust√≠vel e come√ßou a procurar um posto de gasolina imediatamente.', shortStoryEnglish: '**English Translation:** In the middle of a long car trip, the driver noticed the fuel warning light come on. He knew he was **running low on** fuel and started looking for a gas station immediately.' },
                    { title: 'Run rampant', translation: 'Sair do controle, se espalhar', emoji: 'üìà', level: 'advanced', example: 'The stock price ran rampant right after the speech.', fullExplanation: 'Descreve algo que est√° se espalhando ou crescendo de forma descontrolada.', shortStory: '**Hist√≥ria:** A fofoca sobre a fus√£o da empresa **se espalhou descontroladamente** pelo escrit√≥rio, criando muita incerteza e ansiedade entre os funcion√°rios. O gerente teve que intervir para acalmar a equipe.', shortStoryEnglish: '**English Translation:** The gossip about the company\'s merger **ran rampant** throughout the office, creating a lot of uncertainty and anxiety among employees. The manager had to intervene to calm the team.' },
                    { title: 'Run through', translation: 'Repassar, revisar', emoji: 'üìù', level: 'advanced', example: 'Would you like me to run through the details with you?', fullExplanation: 'Usado para pedir para revisar ou explicar algo rapidamente.', shortStory: '**Hist√≥ria:** Antes de subir ao palco para sua apresenta√ß√£o, o palestrante olhou para sua equipe e disse: \'Vamos **repassar** os pontos principais uma √∫ltima vez para ter certeza de que n√£o esquecemos nada.\'', shortStoryEnglish: '**English Translation:** Before going on stage for his presentation, the speaker looked at his team and said: \'Let\'s **run through** the main points one last time to make sure we haven\'t forgotten anything.\'' },
                    { title: 'Running to the toilet', translation: 'correr para o banheiro (com urg√™ncia)', emoji: 'üöΩüí®', level: 'advanced', example: 'I\'m running to the toilet. This bad sushi is giving me the runs.', fullExplanation: 'Indica a necessidade urgente de ir ao banheiro, muitas vezes por causa de uma dor de est√¥mago ou intoxica√ß√£o alimentar. √â uma forma de expressar pressa e desconforto.', shortStory: '**Hist√≥ria:** Ap√≥s comer um prato de marisco estragado, Laura come√ßou a sentir uma dor de est√¥mago terr√≠vel. Ela de repente se levantou da mesa e disse aos seus amigos: "Desculpem, **tenho que correr para o banheiro**!".', shortStoryEnglish: '**English Translation:** After eating a bad seafood dish, Laura started to feel a terrible stomach ache. She suddenly got up from the table and said to her friends: "Excuse me, I **have to run to the toilet**!".' },
                    { title: 'Run the clock', translation: 'Mover o rel√≥gio pra frente/tr√°s', emoji: '‚è∞üîÑ', level: 'advanced', example: 'He ran the clock back to review the last few seconds of the game.', fullExplanation: '√â usado para descrever o ato de mover o tempo para tr√°s ou para a frente em um cron√¥metro ou rel√≥gio, geralmente para revis√£o ou corre√ß√£o. √â mais comum em contextos de tecnologia, jogos ou esportes.', shortStory: '**Hist√≥ria:** O √°rbitro de futebol americano consultou a revis√£o da jogada. Para ter certeza de que a contagem de tempo estava correta, ele pediu ao operador para **mover o rel√≥gio para tr√°s** e para a frente, analisando cada segundo da jogada para que a decis√£o fosse tomada corretamente.', shortStoryEnglish: '**English Translation:** The football referee consulted the replay. To make sure the clock count was correct, he asked the operator to **run the clock backwards** and forwards, analyzing each second of the play to make the right call.' }
                ],
            },
            business: {
                title: 'Business Expressions',
                emoji: 'üíº',
                color: 'bg-blue-600',
                expressions: [
                    { title: 'Run a business', translation: 'Gerenciar/administrar um neg√≥cio', emoji: 'üè¢', level: 'business', example: 'She runs an import/export business.', fullExplanation: 'Descreve o ato de gerir ou ser respons√°vel por um neg√≥cio.', shortStory: '**Hist√≥ria:** Ap√≥s anos como gerente de vendas, Sofia finalmente realizou seu sonho de abrir uma loja de roupas. Ela agora **administra** seu pr√≥prio neg√≥cio, e adora a liberdade e os desafios de ser sua pr√≥pria chefe.', shortStoryEnglish: '**English Translation:** After years as a sales manager, Sofia finally fulfilled her dream of opening a clothing store. She now **runs** her own business, and loves the freedom and challenges of being her own boss.' },
                    { title: 'Run late (in business)', translation: 'Estar atrasado (servi√ßo)', emoji: '‚è≥', level: 'business', example: 'The bus is running an hour late, because of an earlier accident.', fullExplanation: 'Usado para indicar que um servi√ßo de transporte, como um √¥nibus ou trem, ou um projeto est√° atrasado em rela√ß√£o ao cronograma, geralmente devido a um imprevisto.', shortStory: '**Hist√≥ria:** Devido a um problema t√©cnico, o trem para a cidade vizinha **est√° atrasado** duas horas. Os passageiros foram informados e agora esperam por uma atualiza√ß√£o no terminal. A empresa de transporte pediu desculpas pelo inconveniente.', shortStoryEnglish: '**English Translation:** Due to a technical problem, the train to the neighboring city **is running** two hours **late**. The passengers have been informed and are now waiting for an update at the terminal. The transport company apologized for the inconvenience.' },
                    { title: 'Run over', translation: 'Ultrapassar (o tempo), estender-se', emoji: '‚è≥', level: 'business', example: 'Let‚Äôs wrap this up; I don‚Äôt want to run over.', fullExplanation: 'Usado para indicar que um evento, como uma reuni√£o ou prazo, se estende al√©m do seu tempo planejado ou alocado.', shortStory: '**Hist√≥ria:** A reuni√£o de equipe come√ßou pontualmente, mas a discuss√£o sobre o novo projeto era t√£o complexa que eles n√£o conseguiam chegar a uma conclus√£o. O gerente, olhando para o rel√≥gio, disse: "Precisamos decidir agora. Eu n√£o quero que a reuni√£o **ultrapasse o tempo** agendado para que todos possam ir para suas pr√≥ximas tarefas.', shortStoryEnglish: '**English Translation:** The team meeting started on time, but the discussion about the new project was so complex that they couldn\'t reach a conclusion. The manager, looking at his watch, said: "We need to decide now. I don\'t want the meeting to **run over** its scheduled time so that everyone can go to their next tasks."' },
                    { title: 'Run a team', translation: 'Liderar uma equipe', emoji: 'ü§ù', level: 'business', example: 'I\'m running a special project this month.', fullExplanation: 'Significa estar no comando de uma equipe ou projeto.', shortStory: '**Hist√≥ria:** No trabalho, o novo projeto de marketing era ambicioso, mas o gerente estava confiante. Ele disse √† equipe: \'Estou feliz em **liderar** este projeto, e tenho certeza que com o trabalho duro de todos, alcan√ßaremos o sucesso.\'', shortStoryEnglish: '**English Translation:** At work, the new marketing project was ambitious, but the manager was confident. He said to the team, \'I am happy to **run** this project, and I\'m sure that with everyone\'s hard work, we will achieve success.' },
                    { title: 'Run a tight ship', translation: 'Ter uma gest√£o rigorosa', emoji: 'üö¢', level: 'business', example: 'The CEO runs a tight ship, so deadlines are always met.', fullExplanation: 'Express√£o idiom√°tica que significa gerenciar uma organiza√ß√£o de forma muito estrita e eficiente.', shortStory: '**Hist√≥ria:** O novo diretor foi contratado para reorganizar a empresa. Desde o primeiro dia, ele mostrou que **tinha uma gest√£o rigorosa**, exigindo pontualidade, disciplina e alta produtividade de todos os funcion√°rios para atingir as metas.', shortStoryEnglish: '**English Translation:** The new director was hired to reorganize the company. From day one, he showed that he **ran a tight ship**, demanding punctuality, discipline, and high productivity from all employees to meet the goals.' },
                    { title: 'Run the numbers/figures', translation: 'Analisar dados', emoji: 'üìä', level: 'business', example: 'Can you run the sales figures for me?', fullExplanation: 'Significa processar ou analisar dados, como finan√ßas ou resultados de vendas, para tomar uma decis√£o.', shortStory: '**Hist√≥ria:** A equipe de vendas precisava tomar uma decis√£o sobre a nova estrat√©gia. O chefe, antes de qualquer conclus√£o, pediu ao analista: \'Antes de decidir, por favor, **analise os n√∫meros** das vendas do m√™s passado para que possamos tomar uma decis√£o com base em dados concretos.\'', shortStoryEnglish: '**English Translation:** The sales team needed to make a decision about the new strategy. The boss, before any conclusion, asked the analyst: \'Before we decide, please **run the numbers** from last month\'s sales so we can make a data-driven decision.' },
                    { title: 'Run through (a document)', translation: 'Repassar/Revisar um documento', emoji: 'üìù', level: 'business', example: 'Can you run through the report with me?', fullExplanation: 'Usado para pedir para revisar ou explicar algo rapidamente, como um documento, relat√≥rio, ou rascunho.', shortStory: '**Hist√≥ria:** O gerente de projeto estava se preparando para a reuni√£o. Ele pegou o rascunho final do relat√≥rio e pediu √† sua assistente: \'Voc√™ pode, por favor, **repassar o relat√≥rio** comigo uma √∫ltima vez para garantir que todos os dados est√£o corretos e que n√£o h√° erros antes de apresentarmos?\'.', shortStoryEnglish: '**English Translation:** The project manager was preparing for the meeting. He grabbed the final draft of the report and asked his assistant: \'Can you please **run through the report** with me one last time to ensure all the data is correct and there are no mistakes before we present it?\' ' },
                    { title: 'Run a scam', translation: 'Aplicar um golpe', emoji: 'üí∏', level: 'business', example: 'They ran a scam on elderly people by selling them fake insurance.', fullExplanation: 'Significa organizar ou executar uma opera√ß√£o fraudulenta para enganar pessoas e ganhar dinheiro ilegalmente.', shortStory: '**Hist√≥ria:** O grupo criminoso **aplicou um golpe** sofisticado, usando sites falsos para roubar informa√ß√µes de cart√£o de cr√©dito de clientes. A pol√≠cia levou meses para rastrear e desmantelar a opera√ß√£o, que j√° tinha causado preju√≠zos a centenas de pessoas.', shortStoryEnglish: '**English Translation:** The criminal group **ran a sophisticated scam**, using fake websites to steal credit card information from customers. It took months for the police to track and dismantle the operation, which had already caused losses to hundreds of people.' },
                    { title: 'Run (a business/a machine)', translation: 'Gerenciar/Operar', emoji: '‚öôÔ∏è', level: 'business', example: 'He runs a successful business.', fullExplanation: 'Significa estar encarregado de ou operar algo de forma eficiente, como um neg√≥cio, um departamento ou uma m√°quina.', shortStory: '**Hist√≥ria:** Ap√≥s anos de experi√™ncia em gest√£o, Jo√£o decidiu abrir sua pr√≥pria empresa de consultoria. Gra√ßas ao seu talento para **gerenciar** e sua equipe dedicada, ele hoje tem um **neg√≥cio de sucesso** que ajuda outras empresas a prosperar.', shortStoryEnglish: '**English Translation:** After years of management experience, Jo√£o decided to open his own consulting firm. Thanks to his talent for **running** and his dedicated team, he now has a **successful business** that helps other companies thrive.' },
                    { title: 'Run a course/session', translation: 'Oferecer um curso/treinamento', emoji: 'üéì', level: 'business', example: 'The local college runs a course in self-defence.', fullExplanation: 'Significa organizar e oferecer uma aula, curso ou sess√£o de treinamento. O foco √© na gest√£o e na oferta do servi√ßo.', shortStory: '**Hist√≥ria:** A universidade local decidiu expandir suas ofertas de educa√ß√£o continuada. Eles anunciaram que iriam **oferecer um curso** de design gr√°fico e uma **sess√£o de treinamento** sobre lideran√ßa para os alunos.', shortStoryEnglish: '**English Translation:** The local college decided to expand its continuing education offerings. They announced that they would **run a course** in graphic design and a **training session** on leadership for the students.' }
                ],
            },
            it: {
                title: 'IT Expressions',
                emoji: 'üíª',
                color: 'bg-teal-600',
                expressions: [
                    { title: 'Run a program/scan', translation: 'Executar um programa/scan', emoji: '‚öôÔ∏è', level: 'it', example: 'Run a scan to check for any malware.', fullExplanation: 'Significa iniciar ou executar um software ou processo em um computador.', shortStory: '**Hist√≥ria:** Um dos computadores da empresa come√ßou a funcionar lentamente e a exibir pop-ups suspeitos. O t√©cnico de TI decidiu **executar** um scan completo para verificar a presen√ßa de v√≠rus e malware, a fim de garantir a seguran√ßa dos dados.', shortStoryEnglish: '**English Translation:** One of the company\'s computers started running slowly and displaying suspicious pop-ups. The IT technician decided to **run** a full scan to check for viruses and malware to ensure data security.' },
                    { title: 'Run the command', translation: 'Executar o comando', emoji: '‚å®Ô∏è', level: 'it', example: 'Run the command to install the new software.', fullExplanation: 'Significa iniciar um comando em um sistema operacional ou shell de linha de comando.', shortStory: '**Hist√≥ria:** O novo servidor precisava ser configurado. O administrador do sistema acessou o terminal e disse ao estagi√°rio: \'Agora, **execute este comando** para iniciar a instala√ß√£o do banco de dados.\'', shortStoryEnglish: '**English Translation:** The new server needed to be configured. The system administrator accessed the terminal and said to the intern: \'Now, **run this command** to start the database installation.\'' },
                    { title: 'Server is running', translation: 'Servidor est√° em funcionamento', emoji: 'üñ•Ô∏è', level: 'it', example: 'The website is down because the server is not running.', fullExplanation: 'Indica que um servidor ou sistema est√° operando e dispon√≠vel.', shortStory: '**Hist√≥ria:** Ap√≥s a manuten√ß√£o programada, a equipe de TI verificou o status dos sistemas. Eles anunciaram: \'Tudo pronto! O servidor principal j√° **est√° em funcionamento** e a conex√£o com a internet est√° de volta ao normal.\'', shortStoryEnglish: '**English Translation:** After the scheduled maintenance, the IT team checked the status of the systems. They announced: \'All set! The main server is **running** again and the internet connection is back to normal.\'' },
                    { title: 'Run a script', translation: 'Executar um script', emoji: 'üìÑ', level: 'it', example: 'The database backup runs automatically every night.', fullExplanation: 'Refere-se √† execu√ß√£o de um script, que √© uma sequ√™ncia de comandos automatizados.', shortStory: '**Hist√≥ria:** O administrador do sistema configurou uma rotina noturna. Agora, o sistema de backup **executa um script** automaticamente √† meia-noite para garantir que todos os dados importantes sejam salvos de forma segura.', shortStoryEnglish: '**English Translation:** The system administrator configured a nightly routine. Now, the backup system **runs a script** automatically at midnight to ensure all important data is saved securely.' },
                    { title: 'Up and running', translation: 'Em pleno funcionamento', emoji: 'üü¢üöÄ', level: 'it', example: 'They had the new computer system up and running within an hour.', fullExplanation: 'Uma express√£o comum que significa que um sistema, servi√ßo ou m√°quina foi instalado, configurado e est√° funcionando corretamente. √â frequentemente usada para indicar que algo est√° pronto para ser usado ap√≥s um per√≠odo de inatividade ou instala√ß√£o.', shortStory: '**Hist√≥ria:** A equipe de TI trabalhou durante a noite toda para migrar o novo servidor da empresa. Na manh√£ seguinte, eles anunciaram com orgulho: \'O novo sistema de computadores est√° **em pleno funcionamento** dentro de uma hora e pronto para uso.\'', shortStoryEnglish: '**English Translation:** The IT team worked all night to migrate the new company server. The next morning, they proudly announced: \'The new computer system is **up and running** within an hour and ready for use.\'' },
                    { title: 'Run on (a system)', translation: 'Funcionar em (um sistema)', emoji: 'ü§ñ', level: 'it', example: 'What version of Android is your app running on?', fullExplanation: 'Usado para descrever o sistema operacional ou plataforma em que um software ou aplicativo est√° sendo executado.', shortStory: '**Hist√≥ria:** O desenvolvedor de aplicativos estava testando sua nova cria√ß√£o. Ele perguntou a um usu√°rio: "Pode me dizer em qual **vers√£o do Android** o seu aplicativo **est√° rodando**? Isso me ajudar√° a solucionar um problema que alguns usu√°rios est√£o enfrentando.".', shortStoryEnglish: '**English Translation:** The app developer was testing his new creation. He asked a user: "Can you tell me what **version of Android** your app **is running on**? It will help me troubleshoot an issue some users are facing.".' }
                ],
            },
            health: {
                title: 'Health Expressions',
                emoji: 'üè•',
                color: 'bg-lime-600',
                expressions: [
                    { title: 'have the runs', translation: 'ter diarreia', emoji: 'üöΩ', level: 'health', example: 'After that street food, I had the runs for a couple of days.', fullExplanation: 'Uma express√£o informal para se referir a diarreia.', shortStory: '**Hist√≥ria:** O turista decidiu experimentar uma comida ex√≥tica na rua, mas infelizmente n√£o caiu bem no est√¥mago. Ele passou os pr√≥ximos dois dias com mal-estar e **teve diarreia** constantemente.', shortStoryEnglish: '**English Translation:** The tourist decided to try some exotic street food, but unfortunately, it didn\'t agree with his stomach. He spent the next two days feeling unwell and constantly **had the runs**.' },
                    { title: 'running nose', translation: 'nariz escorrendo', emoji: 'ü§ß', level: 'health', example: 'My nose is running, I need a tissue.', fullExplanation: 'Refere-se ao l√≠quido que escorre do nariz, geralmente devido a um resfriado ou alergia.', shortStory: '**Hist√≥ria:** Depois de ficar doente, a primeira coisa que o paciente notou foi uma coceira na garganta e um **nariz escorrendo** sem parar, o que o fez usar muitos len√ßos.', shortStoryEnglish: '**English Translation:** After getting sick, the first thing the patient noticed was a scratchy throat and a constantly **running nose**, which made him use a lot of tissues.' },
                    { title: 'Run an experiment', translation: 'Fazer um experimento', emoji: 'üß™üî¨', level: 'health', example: 'We\'re running an experiment to test the new drug.', fullExplanation: 'Significa conduzir ou realizar um estudo cient√≠fico ou teste para observar um resultado ou confirmar uma hip√≥tese. √â um uso comum do verbo "run" em ambientes de pesquisa e laborat√≥rios.', shortStory: '**Hist√≥ria:** A equipe de cientistas passou meses no laborat√≥rio, testando diferentes subst√¢ncias. Agora, eles estavam prontos para **fazer um experimento** final para ver se a nova droga poderia curar a doen√ßa, uma pesquisa que poderia mudar o futuro da medicina.', shortStoryEnglish: '**English Translation:** The team of scientists spent months in the lab, testing different substances. Now, they were ready to **run an experiment** to see if the new drug could cure the disease, a research that could change the future of medicine.' },
                    { title: 'Go for a run', translation: 'Sair para correr', emoji: 'üèÉ‚Äç‚ôÄÔ∏è', level: 'health', example: 'We go for a three-mile run every evening after work.', fullExplanation: 'Uma express√£o comum para o ato de sair para correr, geralmente com foco em exerc√≠cio f√≠sico ou recrea√ß√£o.', shortStory: '**Hist√≥ria:** Ap√≥s um longo dia de trabalho no escrit√≥rio, Jo√£o sentiu a necessidade de se exercitar. Ele colocou seus t√™nis de corrida e disse √† esposa: "Vou **sair para correr** no parque, volto em cerca de uma hora. Sinto que preciso de um pouco de ar fresco."', shortStoryEnglish: '**English Translation:** After a long day of work at the office, Jo√£o felt the need to exercise. He put on his running shoes and told his wife: "I\'m going to **go for a run** in the park, I\'ll be back in about an hour. I feel like I need some fresh air.".' }
                ],
            },
        };

        const exerciseData = {
            lower_intermediate: {
                fill_in_the_blanks: [
                    { story: "Yesterday, I went for a morning __ (run). The road __ (runs) along the park, so it was a pleasant experience. On my way, I accidentally __ (ran into) my old friend from school. I told him I had to __ (run) for a meeting, but we promised to catch up later.", answers: ["run", "runs", "ran into", "run"] },
                    { story: "The car engine is not __ (running) properly, so I'm __ (running) low on fuel. I need to find a gas station before I __ (run) out of gas.", answers: ["running", "running", "run"] },
                    { story: "My phone is __ (running) low on battery. I will have to __ (run) home to charge it before I go out. Sorry, I can't stay. I gotta __ (run)!", answers: ["running", "run", "run"] },
                    { story: "I didn't expect to __ (run into) my old neighbor at the coffee shop. I was just __ (running) some errands and was surprised to see him. We chatted for a bit, but I had to __ (run) to my next appointment.", answers: ["run into", "running", "run"] },
                    { story: "The project __ (ran) a big risk, but it paid off. She was driving too fast and __ (ran) a red light, which is illegal. The company's stock price __ (ran) rampant after the news.", answers: ["ran", "ran", "ran"] }
                ],
                matching: [
                    { pt: "Estar atrasado", en: "Running late" },
                    { pt: "Encontrar por acaso", en: "Run into someone" },
                    { pt: "Abrir a torneira", en: "Run a tap" },
                    { pt: "Fugir", en: "Run away" },
                    { pt: "Correr a uma velocidade espec√≠fica", en: "Run at a specific speed" },
                    { pt: "Avan√ßar o sinal vermelho", en: "Run a red light" },
                    { pt: "Correr um risco", en: "Run a risk" }
                ],
                translation: [
                    { pt: "Tenho que ir!", en: "Gotta run!" },
                    { pt: "O motor est√° funcionando.", en: "The engine is running." },
                    { pt: "Corri para dentro da casa.", en: "I ran into the house." },
                    { pt: "Eles est√£o correndo sem tempo.", en: "They are running out of time." },
                    { pt: "A estrada corre ao lado do rio.", en: "The road runs along the river." },
                    { pt: "Ele avan√ßou o sinal vermelho.", en: "He ran a red light." },
                    { pt: "N√£o corra um risco desnecess√°rio.", en: "Don't run a needless risk." }
                ]
            },
            advanced: {
                fill_in_the_blanks: [
                    { story: "The new CEO decided to __ (run) a tight ship to improve productivity. We were __ (running) out of time to complete the project, so he asked us to __ (run) the numbers one last time. In the __ (long) run, this will pay off.", answers: ["run", "running", "run", "long"] },
                    { story: "The company's stock price __ (ran) rampant after the news. He is currently __ (running) for a political office, but it seems he is __ (running) into some problems.", answers: ["ran", "running", "running"] },
                    { story: "I asked the new intern to __ (run) a script to automate the process. He is still learning, so he is __ (running) through the manual before he starts.", answers: ["run", "running"] },
                ],
                matching: [
                    { pt: "Gerenciar um neg√≥cio", en: "Run a business" },
                    { pt: "Repassar os detalhes", en: "Run through the details" },
                    { pt: "A longo prazo", en: "In the long run" },
                    { pt: "Ter uma gest√£o rigorosa", en: "Run a tight ship" },
                    { pt: "Sair do controle", en: "Run rampant" },
                ],
                translation: [
                    { pt: "Ela se candidatou para um cargo.", en: "She ran for office." },
                    { pt: "As fofocas se espalharam descontroladamente.", en: "The rumors ran rampant." },
                    { pt: "Voc√™ pode analisar os n√∫meros para mim?", en: "Can you run the numbers for me?" },
                    { pt: "O servidor est√° em funcionamento.", en: "The server is running." },
                    { pt: "Ele lidera uma equipe de marketing.", en: "He runs a marketing team." },
                ]
            }
        };
    </script>

    <!-- Header & Navigation -->
    <header class="flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0 sm:space-x-6 mb-12">
        <h1 class="text-3xl sm:text-5xl font-extrabold text-red-600 tracking-wide text-center sm:text-left">
            <span class="font-light">Run</span> - Expressions by Daby
        </h1>
        <nav class="flex flex-wrap justify-center sm:justify-start gap-2 sm:gap-4 text-gray-300">
            <button id="expressions-btn" class="px-4 py-2 rounded-full font-semibold transition-colors duration-200 bg-red-600 text-white shadow-lg hover:bg-red-500">
                üìö Expressions
            </button>
            <button id="exercises-btn" class="px-4 py-2 rounded-full font-semibold transition-colors duration-200 bg-gray-800 hover:bg-blue-500 text-gray-300">
                üß† Exercises
            </button>
        </nav>
    </header>

    <!-- Main Content Container -->
    <div id="main-content">
        <!-- Expressions Section (Initially visible) -->
        <div id="expressions-section">
            <nav id="expression-categories" class="flex flex-wrap justify-center gap-2 sm:gap-4 text-gray-300 mb-8">
                <!-- Categories will be rendered here by JS -->
            </nav>
            <div id="expressions-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-2">
                <!-- Expression cards will be rendered here by JS -->
            </div>
        </div>

        <!-- Exercises Section (Initially hidden) -->
        <div id="exercises-section" class="hidden">
            <div id="exercise-level-selector" class="flex flex-col items-center justify-center min-h-[50vh]">
                <p class="text-2xl text-gray-500 mb-4">Select an exercise level to begin.</p>
                <div class="flex space-x-4">
                    <button data-level="lower_intermediate" class="exercise-level-btn px-4 py-2 rounded-full font-semibold transition-colors duration-200 bg-gray-800 hover:bg-green-500 text-gray-300">
                        üü¢ Lower Intermediate
                    </button>
                    <button data-level="advanced" class="exercise-level-btn px-4 py-2 rounded-full font-semibold transition-colors duration-200 bg-gray-800 hover:bg-red-500 text-gray-300">
                        üöÄ Advanced
                    </button>
                </div>
            </div>
            <div id="exercise-type-selector" class="hidden flex flex-col items-center justify-center min-h-[50vh]">
                <p id="exercise-type-title" class="text-2xl text-gray-500 mb-4"></p>
                <div class="flex flex-wrap justify-center gap-4">
                    <button data-type="fill_in_the_blanks" class="exercise-type-btn px-6 py-3 bg-blue-600 rounded-full font-semibold hover:bg-blue-700 transition-colors">
                        Completar a Lacuna
                    </button>
                    <button data-type="matching" class="exercise-type-btn px-6 py-3 bg-purple-600 rounded-full font-semibold hover:bg-purple-700 transition-colors">
                        Correspond√™ncia
                    </button>
                    <button data-type="translation" class="exercise-type-btn px-6 py-3 bg-yellow-600 rounded-full font-semibold hover:bg-yellow-700 transition-colors">
                        Tradu√ß√£o
                    </button>
                </div>
            </div>
            <div id="exercise-content" class="hidden">
                <!-- Exercises will be rendered here by JS -->
            </div>
        </div>
    </div>

    <!-- Modal for detailed expression view -->
    <div id="expression-modal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 p-4">
        <div id="modal-content" class="relative w-full max-w-4xl bg-gray-900 rounded-lg shadow-xl p-6 sm:p-8 border-t-4 border-red-600">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <!-- Modal content will be populated by JS -->
        </div>
    </div>

    <!-- JavaScript for all functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const expressionsBtn = document.getElementById('expressions-btn');
            const exercisesBtn = document.getElementById('exercises-btn');
            const expressionsSection = document.getElementById('expressions-section');
            const exercisesSection = document.getElementById('exercises-section');
            const expressionCategories = document.getElementById('expression-categories');
            const expressionsGrid = document.getElementById('expressions-grid');
            const expressionModal = document.getElementById('expression-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const modalContent = document.getElementById('modal-content');
            
            const exerciseLevelSelector = document.getElementById('exercise-level-selector');
            const exerciseTypeSelector = document.getElementById('exercise-type-selector');
            const exerciseContent = document.getElementById('exercise-content');
            const exerciseTypeTitle = document.getElementById('exercise-type-title');

            let currentLevel = null;
            let currentCategory = 'business';

            // --- UI Rendering Functions ---

            // Renders the categories navigation buttons
            function renderCategories() {
                expressionCategories.innerHTML = '';
                Object.keys(expressionsData).forEach(category => {
                    const data = expressionsData[category];
                    const button = document.createElement('button');
                    button.textContent = `${data.emoji} ${getCategoryLabel(category)}`;
                    button.classList.add('px-4', 'py-2', 'rounded-full', 'font-semibold', 'transition-colors', 'duration-200', 'hover:bg-gray-700', 'text-gray-300');
                    button.dataset.category = category;
                    button.onclick = () => {
                        currentCategory = category;
                        renderExpressions();
                        updateCategoryButtons();
                    };
                    expressionCategories.appendChild(button);
                });
                updateCategoryButtons();
            }

            // Updates the active state of category buttons
            function updateCategoryButtons() {
                document.querySelectorAll('#expression-categories button').forEach(btn => {
                    if (btn.dataset.category === currentCategory) {
                        btn.classList.add(expressionsData[currentCategory].color, 'text-white', 'shadow-lg');
                        btn.classList.remove('bg-gray-800', 'hover:bg-gray-700');
                    } else {
                        btn.classList.remove('bg-red-600', 'bg-green-600', 'bg-blue-600', 'bg-teal-600', 'bg-lime-600', 'text-white', 'shadow-lg');
                        btn.classList.add('bg-gray-800', 'hover:bg-gray-700');
                    }
                });
            }

            // Renders the expression cards for the selected category
            function renderExpressions() {
                expressionsGrid.innerHTML = '';
                const expressions = expressionsData[currentCategory].expressions;
                expressions.forEach(expression => {
                    const card = document.createElement('div');
                    card.classList.add('relative', 'h-48', 'bg-gray-800', 'rounded-lg', 'shadow-lg', 'overflow-hidden', 'cursor-pointer', 'transform', 'transition-transform', 'duration-300', 'hover:scale-105', 'hover:bg-gray-700');
                    card.innerHTML = `
                        <div class="p-4 h-full flex flex-col justify-end">
                            <span class="absolute top-2 right-2 text-xs font-semibold px-2 py-1 rounded-full ${expressionsData[currentCategory].color}">
                                ${getCategoryLabel(expression.level)}
                            </span>
                            <h3 class="text-lg sm:text-xl font-bold text-red-400">
                                ${expression.emoji} ${expression.title}
                            </h3>
                            <p class="text-sm text-gray-400 mt-1 truncate">${expression.translation}</p>
                            <p class="text-xs text-gray-500 mt-2 italic truncate">Ex: "${expression.example}"</p>
                        </div>
                    `;
                    card.onclick = () => showExpressionModal(expression);
                    expressionsGrid.appendChild(card);
                });
            }

            // Shows the modal with a detailed expression
            function showExpressionModal(expression) {
                const categoryColor = expressionsData[expression.level]?.color || 'bg-gray-500';
                modalContent.innerHTML = `
                    <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <h3 class="text-2xl sm:text-3xl font-bold text-red-500 mb-2">
                        ${expression.emoji} ${expression.title}
                    </h3>
                    <span class="inline-block text-xs font-semibold px-2 py-1 rounded-full ${categoryColor} mb-4">
                        ${getCategoryLabel(expression.level)}
                    </span>
                    <p class="text-lg text-gray-300 mb-4">
                        <span class="font-semibold">Translation:</span> ${expression.translation}
                    </p>
                    <p class="text-md text-gray-200 mb-4">
                        <span class="font-semibold">Explanation:</span> ${expression.fullExplanation}
                    </p>
                    <p class="text-sm text-gray-400 mb-6 italic">
                        <span class="font-semibold not-italic">Example:</span> "${expression.example}"
                    </p>
                    <h4 class="text-xl sm:text-2xl font-bold mb-4 mt-6">Real situation:</h4>
                    <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                        <div class="prose prose-invert max-w-none text-gray-300 leading-relaxed sm:w-1/2">
                            ${expression.shortStory.replace(/\n\n/g, '<p>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
                        </div>
                        <div class="prose prose-invert max-w-none text-gray-400 leading-relaxed sm:w-1/2">
                            ${expression.shortStoryEnglish.replace(/\n\n/g, '<p>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
                        </div>
                    </div>
                `;
                expressionModal.classList.remove('hidden');
                document.getElementById('close-modal-btn').onclick = () => expressionModal.classList.add('hidden');
            }

            // Renders the fill-in-the-blanks exercise
            function renderFillInTheBlanks(level) {
                const questions = exerciseData[level].fill_in_the_blanks;
                exerciseContent.innerHTML = `
                    <div class="space-y-8">
                        <h3 class="text-xl font-bold text-red-400">Fill in the Blanks</h3>
                        ${questions.map((q, qIndex) => `
                            <div class="p-4 bg-gray-800 rounded-lg">
                                <p class="text-lg leading-relaxed story-text" data-index="${qIndex}">${q.story.replace(/\((.*?)\)/g, '')}</p>
                                <div class="correct-answers hidden mt-4 text-sm text-gray-400">
                                    <p>Correct Answers:</p>
                                    <ul class="list-disc list-inside mt-2">
                                        ${q.answers.map(answer => `<li>${answer}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `).join('')}
                        <div class="flex space-x-4">
                            <button id="check-blanks" class="px-6 py-2 bg-blue-600 rounded-full font-semibold hover:bg-blue-700 transition-colors">
                                Check Answers
                            </button>
                            <button id="reset-blanks" class="px-6 py-2 bg-gray-600 rounded-full font-semibold hover:bg-gray-700 transition-colors">
                                Reset
                            </button>
                        </div>
                    </div>
                `;

                // Add input fields to the rendered story texts
                document.querySelectorAll('.story-text').forEach(storyDiv => {
                    const qIndex = storyDiv.dataset.index;
                    let storyHTML = storyDiv.innerHTML;
                    const answers = exerciseData[level].fill_in_the_blanks[qIndex].answers;

                    answers.forEach((answer, aIndex) => {
                        storyHTML = storyHTML.replace('__', `<input type="text" class="fill-in-input inline-block w-24 p-1 mx-2 rounded-md text-gray-900 bg-gray-200 focus:outline-none" data-q-index="${qIndex}" data-a-index="${aIndex}" />`);
                    });
                    storyDiv.innerHTML = storyHTML;
                });
                
                // Add event listeners for buttons
                document.getElementById('check-blanks').onclick = () => checkFillInTheBlanks(level);
                document.getElementById('reset-blanks').onclick = () => renderFillInTheBlanks(level);
            }

            // Checks the fill-in-the-blanks answers and provides feedback
            function checkFillInTheBlanks(level) {
                const questions = exerciseData[level].fill_in_the_blanks;
                document.querySelectorAll('.fill-in-input').forEach(input => {
                    const qIndex = input.dataset.qIndex;
                    const aIndex = input.dataset.aIndex;
                    const correctAnswer = questions[qIndex].answers[aIndex];
                    if (input.value.trim().toLowerCase() === correctAnswer.toLowerCase()) {
                        input.classList.remove('bg-gray-200');
                        input.classList.add('bg-green-300', 'text-black');
                    } else {
                        input.classList.remove('bg-gray-200');
                        input.classList.add('bg-red-300', 'text-black');
                    }
                });
                document.querySelectorAll('.correct-answers').forEach(div => div.classList.remove('hidden'));
            }

            // Renders the matching exercise
            function renderMatching(level) {
                const questions = exerciseData[level].matching;
                const leftItems = questions.map(item => item.pt);
                const rightItems = questions.map(item => item.en).sort(() => Math.random() - 0.5);

                exerciseContent.innerHTML = `
                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-red-400">Matching Exercise</h3>
                        <p class="text-gray-400">Match the Portuguese expression with its English translation.</p>
                        <div class="flex justify-between items-start space-x-4">
                            <div class="w-1/2 space-y-2">
                                ${leftItems.map((item, index) => `<div class="p-4 bg-gray-800 rounded-lg text-lg">${item}</div>`).join('')}
                            </div>
                            <div id="right-items" class="w-1/2 space-y-2">
                                ${rightItems.map((item, index) => `<div data-item="${item}" class="matching-item p-4 rounded-lg cursor-pointer transition-colors duration-200 bg-gray-800 hover:bg-gray-700 text-lg">${item}</div>`).join('')}
                            </div>
                        </div>
                        <div class="flex space-x-4 mt-6">
                            <button id="check-matching" class="px-6 py-2 bg-blue-600 rounded-full font-semibold hover:bg-blue-700 transition-colors">
                                Show Answers
                            </button>
                            <button id="reset-matching" class="px-6 py-2 bg-gray-600 rounded-full font-semibold hover:bg-gray-700 transition-colors">
                                Reset
                            </button>
                        </div>
                    </div>
                `;

                document.getElementById('check-matching').onclick = () => checkMatching(level);
                document.getElementById('reset-matching').onclick = () => renderMatching(level);
            }

            // Checks the matching answers
            function checkMatching(level) {
                const questions = exerciseData[level].matching;
                const rightItemsDivs = document.querySelectorAll('.matching-item');
                rightItemsDivs.forEach(div => {
                    const ptText = questions.find(q => q.en === div.dataset.item).pt;
                    const leftItemDiv = [...document.querySelectorAll('.w-1\/2 > div')].find(d => d.textContent.includes(ptText));
                    if (leftItemDiv) {
                        div.classList.remove('bg-gray-800', 'hover:bg-gray-700');
                        div.classList.add('bg-green-600');
                    } else {
                         div.classList.remove('bg-gray-800', 'hover:bg-gray-700');
                         div.classList.add('bg-red-600');
                    }
                });
            }

            // Renders the translation exercise
            function renderTranslation(level) {
                const questions = exerciseData[level].translation;
                exerciseContent.innerHTML = `
                    <div class="space-y-8">
                        <h3 class="text-xl font-bold text-red-400">Translation (Portuguese to English)</h3>
                        ${questions.map((q, index) => `
                            <div class="p-4 bg-gray-800 rounded-lg">
                                <p class="text-lg font-semibold text-gray-300">Question ${index + 1}:</p>
                                <p class="text-md mt-2 text-gray-100">"${q.pt}"</p>
                                <textarea class="translation-input mt-4 w-full p-2 rounded-md text-gray-900 bg-gray-200 focus:outline-none" placeholder="Your translation here..." rows="3" data-index="${index}"></textarea>
                                <div class="correct-answer hidden mt-2 text-sm text-gray-400">
                                    <p>Correct Answer:</p>
                                    <p class="italic text-green-400">"${q.en}"</p>
                                </div>
                            </div>
                        `).join('')}
                        <div class="flex space-x-4">
                            <button id="check-translation" class="px-6 py-2 bg-blue-600 rounded-full font-semibold hover:bg-blue-700 transition-colors">
                                Check Answers
                            </button>
                            <button id="reset-translation" class="px-6 py-2 bg-gray-600 rounded-full font-semibold hover:bg-gray-700 transition-colors">
                                Reset
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('check-translation').onclick = () => checkTranslation(level);
                document.getElementById('reset-translation').onclick = () => renderTranslation(level);
            }

            // Checks the translation answers
            function checkTranslation(level) {
                const questions = exerciseData[level].translation;
                document.querySelectorAll('.translation-input').forEach(input => {
                    const index = input.dataset.index;
                    const correctAnswer = questions[index].en;
                    if (input.value.trim().toLowerCase() === correctAnswer.toLowerCase()) {
                        input.classList.remove('bg-gray-200');
                        input.classList.add('bg-green-300', 'text-black');
                    } else {
                        input.classList.remove('bg-gray-200');
                        input.classList.add('bg-red-300', 'text-black');
                    }
                });
                document.querySelectorAll('.correct-answer').forEach(div => div.classList.remove('hidden'));
            }

            // Helper function to get category label
            function getCategoryLabel(category) {
                const labels = {
                    'lower_intermediate': 'Lower Intermediate',
                    'advanced': 'Advanced',
                    'business': 'Business',
                    'it': 'IT',
                    'health': 'Health',
                };
                return labels[category] || category;
            }

            // --- Event Listeners and Initial Load ---
            expressionsBtn.onclick = () => {
                expressionsSection.classList.remove('hidden');
                exercisesSection.classList.add('hidden');
                expressionsBtn.classList.remove('bg-gray-800', 'hover:bg-blue-500');
                expressionsBtn.classList.add('bg-red-600', 'text-white', 'shadow-lg');
                exercisesBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                exercisesBtn.classList.add('bg-gray-800', 'hover:bg-red-500');
            };

            exercisesBtn.onclick = () => {
                exercisesSection.classList.remove('hidden');
                expressionsSection.classList.add('hidden');
                exercisesBtn.classList.remove('bg-gray-800', 'hover:bg-blue-500');
                exercisesBtn.classList.add('bg-blue-600', 'text-white', 'shadow-lg');
                expressionsBtn.classList.remove('bg-red-600', 'text-white', 'shadow-lg');
                expressionsBtn.classList.add('bg-gray-800', 'hover:bg-red-500');
                
                // Reset exercise view on switch
                exerciseLevelSelector.classList.remove('hidden');
                exerciseTypeSelector.classList.add('hidden');
                exerciseContent.classList.add('hidden');
                currentLevel = null;
            };

            document.querySelectorAll('.exercise-level-btn').forEach(btn => {
                btn.onclick = () => {
                    currentLevel = btn.dataset.level;
                    exerciseLevelSelector.classList.add('hidden');
                    exerciseTypeSelector.classList.remove('hidden');
                    exerciseTypeTitle.textContent = `Select an exercise type for ${getCategoryLabel(currentLevel)}.`;
                };
            });

            document.querySelectorAll('.exercise-type-btn').forEach(btn => {
                btn.onclick = () => {
                    const type = btn.dataset.type;
                    exerciseTypeSelector.classList.add('hidden');
                    exerciseContent.classList.remove('hidden');
                    if (type === 'fill_in_the_blanks') renderFillInTheBlanks(currentLevel);
                    if (type === 'matching') renderMatching(currentLevel);
                    if (type === 'translation') renderTranslation(currentLevel);
                };
            });

            // Initial render
            renderCategories();
            renderExpressions();
        });
    </script>
</body>
</html>
